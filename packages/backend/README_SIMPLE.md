# ä»£ç†è®°è´¦è¥è¿å†…éƒ¨ç³»ç»Ÿ - ç®€åŒ–ç‰ˆåç«¯æœåŠ¡

## é¡¹ç›®ç»“æ„é‡æ„è¯´æ˜

åŸæ¥çš„ `simple_server.py` æ–‡ä»¶è¿‡äºåºå¤§ï¼ˆ1400+è¡Œï¼‰ï¼Œç°å·²é‡æ„ä¸ºæ¨¡å—åŒ–ç»“æ„ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

## æ–°çš„é¡¹ç›®ç»“æ„

```
packages/backend/
â”œâ”€â”€ app/                          # ä¸»åº”ç”¨åŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                   # ä¸»åº”ç”¨æ–‡ä»¶ï¼Œè·¯ç”±æ³¨å†Œ
â”‚   â”œâ”€â”€ utils.py                  # å·¥å…·å‡½æ•°ï¼ˆJWTç”Ÿæˆã€åˆ†é¡µç­‰ï¼‰
â”‚   â”œâ”€â”€ data/                     # æ•°æ®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ users.py              # ç”¨æˆ·æ•°æ®
â”‚   â”‚   â”œâ”€â”€ permissions.py        # æƒé™æ•°æ®
â”‚   â”‚   â”œâ”€â”€ roles.py              # è§’è‰²æ•°æ®
â”‚   â”‚   â””â”€â”€ contracts.py          # åˆåŒç›¸å…³æ•°æ®
â”‚   â””â”€â”€ routers/                  # è·¯ç”±æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ auth.py               # è®¤è¯è·¯ç”±
â”‚       â”œâ”€â”€ users.py              # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚       â”œâ”€â”€ permissions.py        # æƒé™ç®¡ç†è·¯ç”±
â”‚       â”œâ”€â”€ roles.py              # è§’è‰²ç®¡ç†è·¯ç”±
â”‚       â”œâ”€â”€ contracts.py          # åˆåŒç›¸å…³è·¯ç”±
â”‚       â”œâ”€â”€ leads.py              # çº¿ç´¢ç®¡ç†è·¯ç”±
â”‚       â””â”€â”€ audit.py              # å®¡è®¡ç›¸å…³è·¯ç”±
â”œâ”€â”€ run_server.py                 # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ docs/legacy/                  # æ—§ç‰ˆæ–‡æ¡£å’Œå¤‡ä»½
â””â”€â”€ README_SIMPLE.md              # æœ¬æ–‡ä»¶
```

## å¯åŠ¨æ–¹å¼

```bash
cd packages/backend
source venv/bin/activate
python3 run_server.py
```

**æ³¨æ„**: æ—§ç‰ˆå•ä½“æ–‡ä»¶å·²ç§»é™¤ï¼Œç°åœ¨åªæ”¯æŒæ¨¡å—åŒ–ç»“æ„ã€‚å¦‚éœ€æŸ¥çœ‹æ—§ç‰ˆä¿¡æ¯ï¼Œè¯·å‚è€ƒ `docs/legacy/LEGACY_SIMPLE_SERVER.md`ã€‚

## æ¨¡å—è¯´æ˜

### 1. æ•°æ®æ¨¡å— (`app/data/`)
- **users.py**: ç”¨æˆ·æ•°æ®å’ŒæŸ¥æ‰¾å‡½æ•°
- **permissions.py**: æƒé™æ•°æ®å’ŒæŸ¥æ‰¾å‡½æ•°
- **roles.py**: è§’è‰²æ•°æ®ã€æƒé™æ˜ å°„å’ŒæŸ¥æ‰¾å‡½æ•°
- **contracts.py**: åˆåŒæ¨¡æ¿ã€ä¹™æ–¹ä¸»ä½“ã€æ”¯ä»˜æ–¹å¼æ•°æ®

### 2. è·¯ç”±æ¨¡å— (`app/routers/`)
- **auth.py**: ç™»å½•ã€åˆ·æ–°tokenç­‰è®¤è¯æ¥å£
- **users.py**: ç”¨æˆ·CRUDæ“ä½œ
- **permissions.py**: æƒé™ç®¡ç†ã€æƒé™æ ‘ã€ç»Ÿè®¡
- **roles.py**: è§’è‰²ç®¡ç†ã€è§’è‰²æƒé™åˆ†é…
- **contracts.py**: åˆåŒæ¨¡æ¿ã€ä¹™æ–¹ä¸»ä½“ã€æ”¯ä»˜æ–¹å¼çš„å®Œæ•´CRUD
- **leads.py**: çº¿ç´¢ç®¡ç†ç›¸å…³æ¥å£
- **audit.py**: å®¡è®¡è®°å½•å’Œå·¥ä½œæµæ¥å£

### 3. å·¥å…·æ¨¡å— (`app/utils.py`)
- JWT tokenç”Ÿæˆå‡½æ•°
- æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
- åˆ†é¡µå·¥å…·å‡½æ•°

## APIæ¥å£

æ‰€æœ‰æ¥å£è·¯å¾„ä¿æŒä¸å˜ï¼ŒåŒ…æ‹¬ï¼š

### è®¤è¯æ¥å£
- `POST /api/v1/auth/login` - ç™»å½•
- `POST /api/v1/auth/refresh` - åˆ·æ–°token

### ç”¨æˆ·ç®¡ç†
- `GET /api/v1/users/` - ç”¨æˆ·åˆ—è¡¨
- `GET /api/v1/users/{user_id}` - ç”¨æˆ·è¯¦æƒ…
- `POST /api/v1/users/` - åˆ›å»ºç”¨æˆ·
- `PUT /api/v1/users/{user_id}` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/v1/users/{user_id}` - åˆ é™¤ç”¨æˆ·

### æƒé™ç®¡ç†
- `GET /api/v1/user-management/permissions/` - æƒé™åˆ—è¡¨
- `GET /api/v1/user-management/permissions/tree` - æƒé™æ ‘
- `GET /api/v1/user-management/permissions/statistics/summary` - æƒé™ç»Ÿè®¡

### è§’è‰²ç®¡ç†
- `GET /api/v1/user-management/roles/` - è§’è‰²åˆ—è¡¨
- `GET /api/v1/user-management/roles/{role_id}/permissions` - è§’è‰²æƒé™
- `POST /api/v1/user-management/roles/{role_id}/permissions` - åˆ†é…æƒé™

### åˆåŒç®¡ç†
- `GET /api/v1/contract-templates/` - åˆåŒæ¨¡æ¿åˆ—è¡¨
- `POST /api/v1/contract-templates/` - åˆ›å»ºæ¨¡æ¿
- `GET /api/v1/contract-templates/statistics/overview` - æ¨¡æ¿ç»Ÿè®¡
- `POST /api/v1/contract-templates/{id}/preview` - æ¨¡æ¿é¢„è§ˆ
- `GET /api/v1/contract-parties/` - ä¹™æ–¹ä¸»ä½“åˆ—è¡¨
- `GET /api/v1/contract-payment-methods/` - æ”¯ä»˜æ–¹å¼åˆ—è¡¨

### çº¿ç´¢ç®¡ç†
- `GET /api/v1/leads/` - çº¿ç´¢åˆ—è¡¨
- `GET /api/v1/lead-sources/active` - æ´»è·ƒçº¿ç´¢æ¥æº
- `GET /api/v1/lead-statuses/active` - æ´»è·ƒçº¿ç´¢çŠ¶æ€
- `GET /api/v1/lead-quotes/xiansuo/{id}` - çº¿ç´¢æŠ¥ä»·

### å®¡è®¡ç®¡ç†
- `GET /api/v1/audit-records/statistics/my` - æˆ‘çš„å®¡è®¡ç»Ÿè®¡
- `GET /api/v1/audit-workflows/pending/my` - æˆ‘çš„å¾…å®¡æ‰¹å·¥ä½œæµ

## é‡æ„ä¼˜åŠ¿

1. **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤
2. **å¯æ‰©å±•æ€§**: æ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ å¯¹åº”çš„æ•°æ®å’Œè·¯ç”±æ¨¡å—
3. **ä»£ç å¤ç”¨**: å·¥å…·å‡½æ•°ç»Ÿä¸€ç®¡ç†ï¼Œé¿å…é‡å¤ä»£ç 
4. **æ¸…æ™°ç»“æ„**: æ•°æ®ã€è·¯ç”±ã€å·¥å…·åˆ†ç¦»ï¼ŒèŒè´£æ˜ç¡®
5. **æ˜“äºæµ‹è¯•**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•
6. **å›¢é˜Ÿåä½œ**: ä¸åŒå¼€å‘è€…å¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæ¨¡å—

## æ³¨æ„äº‹é¡¹

- æ–°ç‰ˆæœ¬å®Œå…¨å…¼å®¹æ—§ç‰ˆæœ¬çš„APIæ¥å£
- æ•°æ®ç»“æ„ä¿æŒä¸å˜ï¼Œå‰ç«¯æ— éœ€ä¿®æ”¹
- ä¿ç•™äº†æ—§ç‰ˆæœ¬æ–‡ä»¶ä½œä¸ºå¤‡ä»½
- è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–ä¿æŒä¸å˜
- è¿™æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé‡å¯åä¼šä¸¢å¤±

## é‡æ„å®ŒæˆçŠ¶æ€

âœ… **å·²å®Œæˆçš„æ¨¡å—**ï¼š
- ç”¨æˆ·ç®¡ç† (`/api/v1/users/`)
- æƒé™ç®¡ç† (`/api/v1/user-management/permissions/`)
- è§’è‰²ç®¡ç† (`/api/v1/user-management/roles/`)
- çº¿ç´¢ç®¡ç† (`/api/v1/leads/`)
- å®¡è®¡è®°å½• (`/api/v1/audit-records/`)
- å®¡è®¡å·¥ä½œæµ (`/api/v1/audit-workflows/`)
- åˆåŒæ¨¡æ¿ (`/api/v1/contract-templates/`)
- åˆåŒä¹™æ–¹ä¸»ä½“ (`/api/v1/contract-parties/`)
- æ”¯ä»˜æ–¹å¼ (`/api/v1/contract-payment-methods/`)
- äº§å“åˆ†ç±» (`/api/v1/product-management/categories/`)
- äº§å“ç®¡ç† (`/api/v1/product-management/products/`)
- **å®¢æˆ·ç®¡ç†** (`/api/v1/customers/`)
- **æœåŠ¡è®°å½•** (`/api/v1/service-records/`)
- **åˆåŒç®¡ç†** (`/api/v1/contracts/`)
- **æ”¯ä»˜ç®¡ç†** (`/api/v1/contract-payments/`, `/api/v1/bank-transfers/`)
- **å®¡æ ¸è§„åˆ™ç®¡ç†** (`/api/v1/audit-rules/`)

ğŸ‰ **é‡æ„å®Œæˆ**ï¼š
- æ‰€æœ‰ä¸»è¦ä¸šåŠ¡æ¨¡å—å·²å®Œæˆé‡æ„
- å‰ç«¯404é”™è¯¯å·²å…¨éƒ¨è§£å†³
- æ¨¡å—åŒ–ç»“æ„æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤
- ä»1400+è¡Œå•æ–‡ä»¶é‡æ„ä¸ºå¤šä¸ª50-150è¡Œçš„æ¨¡å—æ–‡ä»¶
- æ—§ç‰ˆå•ä½“æ–‡ä»¶å·²æ¸…ç†ï¼Œé¿å…ç»´æŠ¤æ··æ·†
