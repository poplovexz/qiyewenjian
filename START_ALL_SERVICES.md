# 🚀 一键启动所有服务指南

## ✅ **已完成！所有服务都已集成到 `start-all.sh`**

现在你可以使用一个命令启动所有服务（后端、前端、移动端）！

---

## 📋 **服务列表**

`start-all.sh` 脚本会自动启动以下三个服务：

| 服务 | 端口 | 技术栈 | 访问地址 |
|------|------|--------|----------|
| **后端服务** | 8000 | Python FastAPI | http://localhost:8000 |
| **前端服务（PC端）** | 5174 | Vue 3 + Element Plus | http://localhost:5174 |
| **移动端服务（H5）** | 5175 | Vue 3 + Vant | http://localhost:5175 |

---

## 🚀 **快速开始**

### **1. 启动所有服务**

```bash
./start-all.sh
```

**输出示例**：
```
==========================================
启动所有服务
==========================================
清理之前的进程...

1. 启动后端服务 (端口 8000)...
   后端服务已启动 (PID: 789589)
   等待后端服务启动（可能需要10-15秒）...
   ✓ 后端服务启动成功（用时 7 秒）

2. 启动前端服务 (端口 5174)...
   ✓ 前端服务启动成功

3. 启动移动端服务 (端口 5175)...
   ✓ 移动端服务启动成功

==========================================
所有服务启动完成！
==========================================
```

### **2. 验证服务状态**

```bash
./verify-all-services.sh
```

**输出示例**：
```
==========================================
  验证所有服务状态
==========================================

1. 检查后端服务 (端口 8000)...
   ✓ 后端服务正在运行
   ✓ 健康检查通过

2. 检查前端服务 (端口 5174)...
   ✓ 前端服务正在运行
   ✓ 前端页面可访问

3. 检查移动端服务 (端口 5175)...
   ✓ 移动端服务正在运行
   ✓ 移动端页面可访问

4. 测试后端登录API...
   ✓ 登录API正常响应
   ✓ 响应速度正常 (<5秒)

🎉 所有服务运行正常！
```

### **3. 停止所有服务**

```bash
./stop-all.sh
```

---

## 📊 **启动流程详解**

### **启动顺序**

1. **清理旧进程**
   - 自动停止占用端口 8000、5174、5175 的进程
   - 确保端口可用

2. **启动后端服务**
   - 激活Python虚拟环境
   - 启动FastAPI应用
   - 连接Redis（可能需要7-15秒）
   - 等待端口8000可用

3. **启动前端服务**
   - 使用pnpm启动Vite开发服务器
   - 等待端口5174可用

4. **启动移动端服务**
   - 使用pnpm启动Vite开发服务器
   - 等待端口5175可用

### **启动时间**

| 服务 | 预计启动时间 |
|------|-------------|
| 后端 | 7-15秒（取决于Redis连接速度） |
| 前端 | 5-8秒 |
| 移动端 | 5-8秒 |
| **总计** | **约20-30秒** |

---

## 🔧 **脚本功能**

### **start-all.sh 的特性**

✅ **自动清理**：启动前自动停止占用端口的旧进程  
✅ **智能等待**：后端最多等待15秒，确保Redis连接完成  
✅ **状态检查**：启动后自动检查每个服务是否成功  
✅ **日志记录**：所有服务日志保存到 `/tmp/` 目录  
✅ **PID跟踪**：显示每个服务的进程ID  
✅ **友好提示**：彩色输出，清晰的成功/失败提示  

### **后端启动命令**

```bash
cd /var/www/packages/backend
source venv/bin/activate
cd src
python main.py
```

### **前端启动命令**

```bash
cd /var/www/packages/frontend
pnpm dev
```

### **移动端启动命令**

```bash
cd /var/www/packages/mobile
pnpm dev
```

---

## 📝 **日志文件**

所有服务的日志都保存在 `/tmp/` 目录：

```bash
# 查看后端日志
tail -f /tmp/backend.log

# 查看前端日志
tail -f /tmp/frontend.log

# 查看移动端日志
tail -f /tmp/mobile.log
```

---

## 🔍 **故障排除**

### **问题1：后端启动失败**

**现象**：
```
✗ 后端服务启动超时，请检查日志
```

**解决方法**：
```bash
# 1. 查看后端日志
tail -50 /tmp/backend.log

# 2. 检查常见问题
# - Redis服务是否运行？
redis-cli ping

# - 数据库是否运行？
sudo service postgresql status

# - 虚拟环境是否正确？
ls -la /var/www/packages/backend/venv/

# 3. 手动启动后端调试
cd /var/www/packages/backend
source venv/bin/activate
cd src
python main.py
```

### **问题2：前端/移动端启动失败**

**现象**：
```
✗ 前端服务启动失败
```

**解决方法**：
```bash
# 1. 查看日志
tail -50 /tmp/frontend.log
# 或
tail -50 /tmp/mobile.log

# 2. 检查依赖是否安装
cd /var/www/packages/frontend  # 或 packages/mobile
pnpm install

# 3. 手动启动调试
pnpm dev
```

### **问题3：端口被占用**

**现象**：
```
端口 8000 被占用，正在停止进程...
```

**说明**：这是正常的，脚本会自动清理。

**手动清理**：
```bash
# 查看占用端口的进程
lsof -i :8000
lsof -i :5174
lsof -i :5175

# 手动停止
./stop-all.sh
```

---

## 🎯 **使用场景**

### **场景1：开发环境启动**

每天开始工作时：
```bash
cd /var/www
./start-all.sh
```

### **场景2：重启所有服务**

修改配置后需要重启：
```bash
./stop-all.sh
./start-all.sh
```

### **场景3：只重启后端**

只修改了后端代码：
```bash
# 停止后端
pkill -9 -f "python.*main.py"

# 启动后端
cd /var/www/packages/backend
source venv/bin/activate
cd src
python main.py
```

---

## 📚 **相关文档**

1. **START_ALL_SERVICES.md** ⭐ - 本文档（启动指南）
2. **PROBLEM_SOLVED.md** - 问题解决总结
3. **verify-all-services.sh** - 服务验证脚本
4. **stop-all.sh** - 停止所有服务脚本

---

## ✅ **验证清单**

启动后请验证以下内容：

- [ ] 后端服务运行正常（http://localhost:8000/docs 可访问）
- [ ] 前端服务运行正常（http://localhost:5174 可访问）
- [ ] 移动端服务运行正常（http://localhost:5175 可访问）
- [ ] 后端API响应正常（运行 `./verify-all-services.sh`）
- [ ] 移动端登录功能正常（访问 http://localhost:5175 并登录）

---

## 🎊 **总结**

**一个命令启动所有服务**：
```bash
./start-all.sh
```

**包含的服务**：
- ✅ 后端服务（FastAPI + PostgreSQL + Redis）
- ✅ 前端服务（Vue 3 + Element Plus）
- ✅ 移动端服务（Vue 3 + Vant）

**启动时间**：约20-30秒

**现在就可以开始使用了！** 🚀

