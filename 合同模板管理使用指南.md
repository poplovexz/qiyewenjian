# 合同模板管理使用指南

## 📋 功能概述

合同模板管理模块是代理记账营运内部系统的核心功能之一，提供完整的合同模板生命周期管理，包括模板创建、编辑、预览、版本控制和变量管理等功能。

## 🚀 快速开始

### 1. 访问系统
- **前端地址**: http://localhost:5174/contract-templates
- **登录信息**: 
  - 用户名: `admin`
  - 密码: `admin123`

### 2. 主要功能
- ✅ 合同模板CRUD操作
- ✅ 富文本编辑器支持
- ✅ 模板变量系统
- ✅ 实时预览功能
- ✅ 版本管理
- ✅ 审批流程
- ✅ 权限控制

## 📊 系统架构

### 后端架构
```
packages/backend/src/
├── models/hetong_guanli/
│   └── hetong_moban.py              # 合同模板数据模型
├── schemas/hetong_guanli/
│   └── hetong_moban_schemas.py      # 数据验证模式
├── services/hetong_guanli/
│   └── hetong_moban_service.py      # 业务逻辑层
├── api/api_v1/endpoints/hetong_guanli/
│   └── hetong_moban.py              # API接口层
└── scripts/
    ├── init_contract_permissions.py # 权限初始化
    ├── init_contract_templates.py   # 示例数据
    └── update_contract_template_table.py # 表结构更新
```

### 前端架构
```
packages/frontend/src/
├── views/contract/
│   ├── ContractTemplateList.vue     # 模板列表页面
│   └── components/
│       ├── ContractTemplateForm.vue # 模板表单组件
│       └── ContractTemplatePreview.vue # 预览组件
├── api/modules/
│   └── contract.ts                  # API客户端
├── stores/modules/
│   └── contract.ts                  # 状态管理
└── router/index.ts                  # 路由配置
```

## 🎯 核心功能详解

### 1. 合同模板管理

#### 模板类型
- **代理记账合同** (`daili_jizhang`): 标准代理记账服务合同
- **增值服务合同** (`zengzhi_fuwu`): 额外增值服务合同
- **咨询服务合同** (`zixun_fuwu`): 专业咨询服务合同

#### 模板状态
- **草稿** (`draft`): 编辑中的模板
- **启用** (`active`): 正在使用的模板
- **归档** (`archived`): 已停用的模板

#### 模板分类
- **标准模板** (`biaozhun`): 通用标准模板
- **定制模板** (`dingzhi`): 客户定制模板

### 2. 变量系统

#### 变量语法
使用双花括号语法：`{{ 变量名 }}`

#### 支持的变量类型
- **字符串** (`string`): 文本内容
- **数字** (`number`): 数值内容
- **日期** (`date`): 日期格式

#### 常用变量示例
```json
{
  "kehu_mingcheng": {"label": "客户名称", "type": "string", "default": ""},
  "fuwu_jiage": {"label": "服务价格", "type": "number", "default": 0},
  "qianyue_riqi": {"label": "签约日期", "type": "date", "default": ""}
}
```

### 3. 版本管理

#### 版本控制
- 每个合同类型只能有一个当前版本
- 支持版本号管理（如：1.0, 1.1, 2.0）
- 历史版本自动归档

#### 审批流程
- **待审批** (`pending`): 新创建或修改的模板
- **已审批** (`approved`): 通过审批的模板
- **已拒绝** (`rejected`): 审批被拒绝的模板

## 🛠️ 使用教程

### 1. 创建新模板

1. 点击"新增模板"按钮
2. 填写基本信息：
   - 模板名称
   - 模板编码（唯一标识）
   - 合同类型
   - 模板分类
3. 编辑模板内容（支持富文本）
4. 配置变量（JSON格式）
5. 保存模板

### 2. 编辑模板

1. 在模板列表中点击"编辑"按钮
2. 修改模板信息或内容
3. 更新变量配置
4. 保存更改

### 3. 预览模板

1. 点击"预览"按钮
2. 输入变量值
3. 查看渲染后的合同内容
4. 支持导出和打印

### 4. 管理模板状态

1. 使用状态切换按钮
2. 支持批量状态更新
3. 查看状态变更历史

## 📈 数据统计

### 统计指标
- 总模板数量
- 各状态模板数量
- 使用频率统计
- 创建时间分布

### API接口
```
GET /api/v1/contract-templates/statistics/overview
```

## 🔐 权限管理

### 权限列表
- `contract_template:read` - 查看模板
- `contract_template:create` - 创建模板
- `contract_template:update` - 更新模板
- `contract_template:delete` - 删除模板
- `contract_template:preview` - 预览模板
- `contract_template:approve` - 审批模板
- `contract_template:export` - 导出模板

### 角色配置
管理员角色默认拥有所有权限，其他角色可根据需要分配特定权限。

## 🔧 技术规范

### 数据库字段
- 使用中文拼音命名：`moban_mingcheng`, `hetong_leixing`
- UUID主键：`id`
- 软删除：`is_deleted`
- 审计字段：`created_at`, `updated_at`, `created_by`

### API规范
- RESTful设计
- 统一响应格式
- 分页支持
- 错误处理

### 前端规范
- Vue 3 Composition API
- TypeScript类型安全
- Element Plus组件库
- 响应式设计

## 🚨 注意事项

### 1. 数据安全
- 所有操作都有权限验证
- 敏感数据加密存储
- 操作日志记录

### 2. 性能优化
- 分页加载大量数据
- 图片和文件懒加载
- 缓存常用数据

### 3. 兼容性
- 支持现代浏览器
- 移动端适配
- 打印友好

## 📞 技术支持

如有问题，请联系技术支持团队或查看：
- API文档: http://localhost:8000/docs
- 系统日志: 后端控制台输出
- 错误排查: 浏览器开发者工具

---

**版本**: v1.0.0  
**更新时间**: 2025-09-17  
**维护团队**: 代理记账系统开发组
