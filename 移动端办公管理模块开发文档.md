# 移动端办公管理模块开发文档

## 📱 项目概述

本文档记录了移动端办公管理模块的开发情况，包括请假申请和报销申请两个核心功能模块。

**开发日期**: 2025-11-11  
**技术栈**: Vue 3 + Vant 4 + TypeScript + Pinia  
**移动端端口**: 5175  

---

## 📂 文件结构

### API接口层
```
packages/mobile/src/api/
└── office.ts                    # 办公管理API封装（请假+报销）
```

### 页面组件
```
packages/mobile/src/views/office/
├── LeaveList.vue               # 请假申请列表页
├── LeaveForm.vue               # 请假申请表单页（新建/编辑）
├── LeaveDetail.vue             # 请假申请详情页
├── ReimbursementList.vue       # 报销申请列表页
├── ReimbursementForm.vue       # 报销申请表单页（新建/编辑）
└── ReimbursementDetail.vue     # 报销申请详情页
```

### 通用组件
```
packages/mobile/src/components/office/
├── ApprovalWorkflow.vue        # 审批流程展示组件
└── ApprovalDialog.vue          # 审批操作对话框组件
```

### 路由配置
```
packages/mobile/src/router/index.ts  # 添加了8个办公管理路由
```

---

## 🎯 功能模块详情

### 1. 请假申请模块

#### 1.1 请假申请列表页 (`LeaveList.vue`)

**功能特性**:
- ✅ 搜索功能（按申请编号搜索）
- ✅ 状态筛选（全部、待审核、审核中、已通过、已拒绝）
- ✅ 下拉刷新
- ✅ 上拉加载更多（分页）
- ✅ 显示关键信息：
  - 申请编号
  - 申请人
  - 请假类型（8种类型）
  - 请假时间范围
  - 请假天数
  - 请假原因
  - 审核状态标签

**请假类型**:
- 事假 (shijia)
- 病假 (bingjia)
- 年假 (nianjia)
- 调休 (tiaoxiu)
- 婚假 (hunjia)
- 产假 (chanjia)
- 陪产假 (peichanjia)
- 丧假 (sangjia)

**路由**: `/office/leave`

#### 1.2 请假申请表单页 (`LeaveForm.vue`)

**功能特性**:
- ✅ 支持新建和编辑两种模式
- ✅ 请假类型选择器（Picker）
- ✅ 开始时间选择器（DatetimePicker）
- ✅ 结束时间选择器（DatetimePicker）
- ✅ 自动计算请假天数
- ✅ 请假原因输入（Textarea，最多500字）
- ✅ 附件上传（最多5个文件）
- ✅ 备注输入（可选，最多200字）
- ✅ 保存草稿功能
- ✅ 提交申请功能
- ✅ 表单验证

**路由**:
- 新建: `/office/leave/create`
- 编辑: `/office/leave/edit/:id`

#### 1.3 请假申请详情页 (`LeaveDetail.vue`)

**功能特性**:
- ✅ 显示完整的申请信息
- ✅ 显示审批流程（使用ApprovalWorkflow组件）
- ✅ 附件下载
- ✅ 根据状态显示操作按钮：
  - 待审核状态：提交审批、编辑、删除
  - 审核中状态：审批通过、审批拒绝（需要权限）
- ✅ 审批操作（使用ApprovalDialog组件）

**路由**: `/office/leave/:id`

---

### 2. 报销申请模块

#### 2.1 报销申请列表页 (`ReimbursementList.vue`)

**功能特性**:
- ✅ 搜索功能（按申请编号搜索）
- ✅ 状态筛选（全部、待审核、审核中、已通过、已拒绝）
- ✅ 下拉刷新
- ✅ 上拉加载更多（分页）
- ✅ 显示关键信息：
  - 申请编号
  - 申请人
  - 报销类型（5种类型）
  - 报销金额（红色高亮显示）
  - 报销时间
  - 报销原因
  - 审核状态标签

**报销类型**:
- 差旅费 (chailvfei)
- 餐饮费 (canyinfei)
- 交通费 (jiaotongfei)
- 办公用品 (banggongyongpin)
- 其他 (qita)

**路由**: `/office/reimbursement`

#### 2.2 报销申请表单页 (`ReimbursementForm.vue`)

**功能特性**:
- ✅ 支持新建和编辑两种模式
- ✅ 报销类型选择器（Picker）
- ✅ 报销金额输入（Number，带¥符号）
- ✅ 报销时间选择器（DatePicker）
- ✅ 报销原因输入（Textarea，最多500字）
- ✅ 附件上传（最多5个文件）
- ✅ 备注输入（可选，最多200字）
- ✅ 保存草稿功能
- ✅ 提交申请功能
- ✅ 表单验证

**路由**:
- 新建: `/office/reimbursement/create`
- 编辑: `/office/reimbursement/edit/:id`

#### 2.3 报销申请详情页 (`ReimbursementDetail.vue`)

**功能特性**:
- ✅ 显示完整的申请信息
- ✅ 报销金额红色高亮显示
- ✅ 显示审批流程（使用ApprovalWorkflow组件）
- ✅ 附件下载
- ✅ 根据状态显示操作按钮：
  - 待审核状态：提交审批、编辑、删除
  - 审核中状态：审批通过、审批拒绝（需要权限）
- ✅ 审批操作（使用ApprovalDialog组件）

**路由**: `/office/reimbursement/:id`

---

## 🧩 通用组件

### 1. ApprovalWorkflow.vue - 审批流程展示组件

**功能特性**:
- ✅ 使用Vant Steps组件展示审批流程
- ✅ 垂直时间线布局
- ✅ 显示每个审批步骤的详细信息：
  - 步骤名称
  - 审核人
  - 审核状态（待处理、已通过、已拒绝、已撤销）
  - 审核意见
  - 处理时间
- ✅ 不同状态使用不同的图标和颜色
- ✅ 支持自动加载审批记录
- ✅ 支持传入审批记录数据

**Props**:
- `workflowId`: 审批流程ID（可选）
- `records`: 审批记录数组（可选）
- `autoFetch`: 是否自动加载（默认true）

**使用示例**:
```vue
<ApprovalWorkflow
  v-if="detail.shenhe_liucheng_id"
  :workflow-id="detail.shenhe_liucheng_id"
/>
```

### 2. ApprovalDialog.vue - 审批操作对话框组件

**功能特性**:
- ✅ 使用Vant Dialog组件
- ✅ 审批结果选择（通过/拒绝）
- ✅ 审批意见输入（Textarea，最多200字）
- ✅ 拒绝时必须填写审批意见
- ✅ 表单验证
- ✅ 支持自定义默认操作

**Props**:
- `visible`: 对话框显示状态
- `title`: 对话框标题（默认"审批"）
- `defaultAction`: 默认操作（'tongguo' | 'jujue'）

**Events**:
- `update:visible`: 更新显示状态
- `submit`: 提交审批结果

**使用示例**:
```vue
<ApprovalDialog
  v-model:visible="approvalDialogVisible"
  :default-action="approvalAction"
  @submit="handleApprovalSubmit"
/>
```

---

## 🔌 API接口

### 请假申请API

```typescript
// 获取请假申请列表
getLeaveList(params: LeaveListParams): Promise<LeaveListResponse>

// 获取请假申请详情
getLeaveDetail(id: string): Promise<LeaveApplication>

// 创建请假申请
createLeave(data: LeaveApplication): Promise<LeaveApplication>

// 更新请假申请
updateLeave(id: string, data: Partial<LeaveApplication>): Promise<LeaveApplication>

// 删除请假申请
deleteLeave(id: string): Promise<void>

// 提交请假申请审批
submitLeave(id: string): Promise<LeaveApplication>

// 审批通过请假申请
approveLeave(id: string, opinion?: string): Promise<LeaveApplication>

// 审批拒绝请假申请
rejectLeave(id: string, opinion: string): Promise<LeaveApplication>
```

### 报销申请API

```typescript
// 获取报销申请列表
getReimbursementList(params: ReimbursementListParams): Promise<ReimbursementListResponse>

// 获取报销申请详情
getReimbursementDetail(id: string): Promise<ReimbursementApplication>

// 创建报销申请
createReimbursement(data: ReimbursementApplication): Promise<ReimbursementApplication>

// 更新报销申请
updateReimbursement(id: string, data: Partial<ReimbursementApplication>): Promise<ReimbursementApplication>

// 删除报销申请
deleteReimbursement(id: string): Promise<void>

// 提交报销申请审批
submitReimbursement(id: string): Promise<ReimbursementApplication>

// 审批通过报销申请
approveReimbursement(id: string, opinion?: string): Promise<ReimbursementApplication>

// 审批拒绝报销申请
rejectReimbursement(id: string, opinion: string): Promise<ReimbursementApplication>
```

### 审批记录API

```typescript
// 获取审批记录
getAuditRecords(workflowId: string): Promise<AuditRecord[]>
```

---

## 🎨 UI/UX特性

### 移动端适配
- ✅ 使用Vant UI组件库，完美适配移动端
- ✅ 响应式布局
- ✅ 触摸友好的交互
- ✅ 底部固定操作按钮
- ✅ 下拉刷新和上拉加载

### 用户体验
- ✅ 清晰的视觉层次
- ✅ 状态标签颜色区分
- ✅ 金额红色高亮显示
- ✅ 加载状态提示
- ✅ 空状态提示
- ✅ 确认对话框（删除、提交等操作）
- ✅ Toast消息提示

### 表单体验
- ✅ 移动端友好的选择器（Picker、DatetimePicker）
- ✅ 字数限制和实时计数
- ✅ 表单验证和错误提示
- ✅ 草稿保存功能

---

## 🚀 部署说明

### 开发环境
```bash
cd packages/mobile
npm run dev
# 访问 http://localhost:5175
```

### 生产构建
```bash
cd packages/mobile
npm run build
```

### 部署到生产服务器
```bash
# 1. 在本地构建
cd packages/mobile
npm run build

# 2. 上传到生产服务器
scp -r dist/* user@172.16.2.221:/var/www/mobile/

# 3. 重启Nginx（如需要）
ssh user@172.16.2.221 'sudo systemctl restart nginx'
```

**生产环境访问**:
- URL: http://172.16.2.221:81
- 通过Nginx反向代理访问

---

## ✅ 测试清单

### 请假申请模块测试
- [ ] 列表页加载和显示
- [ ] 搜索功能
- [ ] 状态筛选
- [ ] 下拉刷新
- [ ] 上拉加载更多
- [ ] 新建请假申请
- [ ] 编辑请假申请
- [ ] 删除请假申请
- [ ] 提交审批
- [ ] 审批通过
- [ ] 审批拒绝
- [ ] 附件上传和下载
- [ ] 审批流程展示

### 报销申请模块测试
- [ ] 列表页加载和显示
- [ ] 搜索功能
- [ ] 状态筛选
- [ ] 下拉刷新
- [ ] 上拉加载更多
- [ ] 新建报销申请
- [ ] 编辑报销申请
- [ ] 删除报销申请
- [ ] 提交审批
- [ ] 审批通过
- [ ] 审批拒绝
- [ ] 附件上传和下载
- [ ] 审批流程展示

---

## 📝 注意事项

1. **API基础路径**: 移动端使用 `/api/v1` 作为基础路径，与前端保持一致
2. **认证**: 所有API请求都需要携带Token（通过请求拦截器自动添加）
3. **权限控制**: 审批操作需要检查用户权限（TODO: 需要后端返回权限信息）
4. **文件上传**: 附件上传功能需要实现文件上传到服务器的逻辑（TODO）
5. **错误处理**: 所有API调用都有错误处理和用户提示

---

## 🔄 与前端的一致性

移动端完全复用了前端的API接口和数据结构，确保了：
- ✅ 相同的数据模型
- ✅ 相同的业务逻辑
- ✅ 相同的审批流程
- ✅ 相同的状态管理

唯一的区别是UI层使用了移动端适配的Vant组件库。

---

## 📊 开发统计

- **API文件**: 1个
- **页面组件**: 6个
- **通用组件**: 2个
- **路由配置**: 8个路由
- **代码行数**: 约2000行
- **开发时间**: 1天

---

**开发完成日期**: 2025-11-11  
**开发人员**: AI Assistant

